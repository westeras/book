# Generating CA-Signed Certificate

The following describes how to generate a cerficate \(used for securing web-based services with SSL\) and sign it with a CA.  You can learn how to create your own custom CA [here](/ssl/generating-a-custom-ca-certificate.md).  This guide assumes you have followed this process and have your own root and intermediate CA certificates available for signing CSRs.

A certificate/private key pair is used to enable SSL \(TLS\) communications for a web service.  Typically you can create one certificate/private key pair that can be utilized by multiple web services for SSL.  This example creates a certificate/private key pair specifically for use on a server.  This enables the server to run SSL-based services which will reference the key and certificate for establishing secure connections.  Client certificates can also be used for two-way SSL connections that require client authentication \(most web services do not require this as it adds some complexity\).

Start by generating the private key:

`openssl genrsa -aes256 -out private/hdfs.avalon.demo.key.pem 2048`

You can omit the `-aes256` if for some reason you can't provide a password when the key is accessed \(i.e. when a secure service is started\).

The private key can now be used to generate a CSR.  Typically you would generate the CSR and send to a CA in order for it to be signed by their certificates, but we will do this ourselves since we are acting as our own CA.  To generate the CSR:

    openssl req \                                    # `req` command generates certificates and CSRs
    -key private/hdfs.avalon.demo.key.pem \          # input key created previous step
    -new \                                           # indicates to create a new CSR
    -sha256 \                                        # sign request with digest sha256
    -out csr/hdfs.avalon.demo.csr.pem                # output file for CSR

The command generates a prompt which asks for some information.  The answers you provide will make up the subject of the certificate, the most important of which is the CN \(Common Name\).  This should always \(unless other requirements exist\) be the FQDN of the server the certificate is designated for.  If your server will be accessed at hello.example.com, then you should provide `hello.example.com` as the CN.  Here's an example of the output generated by this command:

```
$ openssl req -key private/hdfs.avalon.demo.key.pem -new -sha256 -out csr/hdfs.avalon.demo.csr.pem
Enter pass phrase for private/hdfs.avalon.demo.key.pem:
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [XX]:US
State or Province Name (full name) []:Texas
Locality Name (eg, city) [Default City]:Austin
Organization Name (eg, company) [Default Company Ltd]:
Organizational Unit Name (eg, section) []:
Common Name (eg, your name or your server's hostname) []:hdfs.avalon.demo
Email Address []:

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
```

You should have a CSR ready for signing in `csr/`.  At this point you'd typically send the CSR to a CA for signing, or in some large organization with an internal CA you may have to upload the CSR via a web interface or email the CSR to a particular team for signing.  We are going to sign our own CSR with our custom CA using the following command:

    sudo openssl ca \                        # `ca` command used to sign CSRs and interact with CA database
    -days 375 \                              # validity of certificate
    -notext \                                # don't put the text form of the certificate in the output file
    -md sha256 \                             # message digest
    -in csr/hdfs.avalon.demo.csr.pem \       # input CSR
    -out hdfs.avalon.demo.cert \             # output certificate
    -keyfile private/intermediate.key.pem \  # intermediate CA private key
    -cert certs/intermediate.cert.pem        # intermediate CA certificate

The command needs to be run as sudo to access the CA databases that track the CA's certificate signing.  You can chown the new cert to your user afterwards.  The certificate is now ready to use.

